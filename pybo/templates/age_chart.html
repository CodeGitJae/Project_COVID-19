{% extends 'base.html' %}

{% block css %}
    <style>
        .card_body {
            position: relative;
            width: 80%;
            height: 1000px; /* 부모 요소의 높이를 설정 */
            background-color: lightgrey; /* 배경색을 설정하여 확인할 수 있도록 함 */
        }

        #ageChart {
            position: absolute;
            top: 100px;
            right: 100px;
            bottom: 100px;
            left: 100px;
            background-color: white; /* 차트 요소의 배경색 */
        }
    </style>
{% endblock %}

{% block content %}

<main id="main">

    <!-- ======= Breadcrumbs ======= -->
    <div class="breadcrumbs">
        <div class="page-header d-flex align-items-center" style="background-image: url('{{url_for('static', filename='assets/img/page-header.jpg')}}');">
        <div class="container position-relative">
          <div class="row d-flex justify-content-center">
            <div class="col-lg-6 text-center">
              <h2>국내 연령대별 누척차트</h2>
              <p>국내코로나19 확진자들을 연령대별로 분류하여 시각화한 누척 차트를 제공합니다.</p>
            </div>
          </div>
        </div>
      </div>
    </div><!-- End Breadcrumbs -->

    <div class="card_body">
        <canvas id="ageChart" width="400" height="200"></canvas>
    </div>
</main>

{% endblock %}

{% block script %}
  <!-- js 넣을거 있으면 여기에 넣으면 됨 -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.3/Chart.min.js"></script>

  <script>
    // '/chart/age_data' 경로에서 데이터를 가져옵니다.
    const age_data = {{ data|tojson }};
    // 차트를 그리기 위한 캔버스 요소를 가져옵니다.
    const ctx = document.getElementById('ageChart').getContext('2d');
    // Chart.js를 사용해 막대 차트를 생성합니다.
    const ageChart = new Chart(ctx, {
        type: 'bar', // 차트 타입을 'bar'로 설정합니다.
        data: {
            // x축 레이블을 설정합니다.
            labels: Object.values(age_data.AgeGroup),
            datasets: [
                {
                    label: '확진자 수',
                    data: Object.values(age_data.Infectee), // 확진자 데이터를 사용합니다.
                    backgroundColor: 'rgba(75, 192, 192, 0.2)', // 막대의 배경색입니다.
                    borderColor: 'rgba(75, 192, 192, 1)', // 막대의 테두리 색입니다.
                    borderWidth: 1, // 막대의 테두리 두께입니다.
                    yAxisID:'y1'

                },
                {
                    label: '사망자 수',
                    data: Object.values(age_data.Death), // 사망자 데이터를 사용합니다.
                    backgroundColor: 'rgba(255, 99, 132, 0.2)', // 막대의 배경색입니다.
                    borderColor: 'rgba(255, 99, 132, 1)', // 막대의 테두리 색입니다.
                    borderWidth: 2, // 막대의 테두리 두께입니다.
                    type:'line',
                    yAxisID:'y2'
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y1: {
                    beginAtZero: true,
                    position: 'left',
                    title: {
                        display: true,
                        text: '확진자', // y축 제목
                        align: 'end'
                    },
                    ticks: {
                        callback: function(value) {
                            return value.toLocaleString() + '명';
                        }
                    }
                },
                y2: {
                    beginAtZero: true,
                    position: 'right',
                    title: {
                        display: true,
                        text: '사망자', // y축 제목
                        align: 'end'
                    },
                    grid: {
                        drawOnChartArea: false
                    },
                    ticks: {
                        callback: function(value) {
                            return value.toLocaleString() + '명';
                        }
                    }
                }
            }
    }
    });
    
  </script>
{% endblock %}