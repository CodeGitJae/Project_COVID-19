{% extends 'base.html' %}

{% block content %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.3/Chart.min.js"></script>

<h2 style="text-align: center;">국내 연령대별 코로나 확진자/사망자 통계차트</h2>
<div class="card_body">
    <canvas id="ageChart" width="400" height="200"></canvas>
</div>
    <script>
        // '/chart/age_data' 경로에서 데이터를 가져옵니다.
        const age_data = {{ data|tojson }};
        // 차트를 그리기 위한 캔버스 요소를 가져옵니다.
        const ctx = document.getElementById('ageChart').getContext('2d');
        // Chart.js를 사용해 막대 차트를 생성합니다.
        const ageChart = new Chart(ctx, {
            type: 'bar', // 차트 타입을 'bar'로 설정합니다.
            data: {
                // x축 레이블을 설정합니다.
                labels: Object.values(age_data.AgeGroup),
                datasets: [
                    {
                        label: '확진자 수',
                        data: Object.values(age_data.Infectee), // 확진자 데이터를 사용합니다.
                        backgroundColor: 'rgba(75, 192, 192, 0.2)', // 막대의 배경색입니다.
                        borderColor: 'rgba(75, 192, 192, 1)', // 막대의 테두리 색입니다.
                        borderWidth: 1, // 막대의 테두리 두께입니다.
                        yAxisID:'y1'

                    },
                    {
                        label: '사망자 수',
                        data: Object.values(age_data.Death), // 사망자 데이터를 사용합니다.
                        backgroundColor: 'rgba(255, 99, 132, 0.2)', // 막대의 배경색입니다.
                        borderColor: 'rgba(255, 99, 132, 1)', // 막대의 테두리 색입니다.
                        borderWidth: 2, // 막대의 테두리 두께입니다.
                        type:'line',
                        yAxisID:'y2'
                    }
                ]
            },
            options: {
            scales: {
                y1: {
                    beginAtZero: true,
                    position: 'left',
                    title: {
                        display: true,
                        text: '확진자', // y축 제목
                        align: 'end'
                    },
                    ticks: {
                        callback: function(value) {
                            return value.toLocaleString() + '명';
                        }
                    }
                },
                y2: {
                    beginAtZero: true,
                    position: 'right',
                    title: {
                        display: true,
                        text: '사망자', // y축 제목
                        align: 'end'
                    },
                    grid: {
                        drawOnChartArea: false
                    },
                    ticks: {
                        callback: function(value) {
                            return value.toLocaleString() + '명';
                        }
                    }
                }
            }
        }
        });
        
    </script>
{% endblock %}